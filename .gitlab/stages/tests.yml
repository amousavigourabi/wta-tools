unit-tests:
  stage: tests

  script:
    - echo "Unit tests started"
    - "mvn surefire:test"
    - "mvn jacoco:report-aggregate"
    - "cat reports/jacoco/index.html | grep -Po 'Total.*?([0-9]{1,3})%'"
  # todo, fail when <80%

  coverage: /Total.*?([0-9]{1,3})%/


integration-tests:
  stage: tests

  script:
    - echo "Integration tests started"
    - "mvn failsafe:integration-test"
    - "mvn jacoco:report-aggregate"
    - "cat reports/jacoco/index.html | grep -Po 'Total.*?([0-9]{1,3})%'"
  # todo, fail when <80%

  coverage: /Total.*?([0-9]{1,3})%/


mutation-tests:
  stage: tests
  allow_failure: true

  script:
    - echo "Mutation tests started"
    - "mvn pitest:report-aggregate"
# todo, fail when <60%
