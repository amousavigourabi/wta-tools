variables:
  SAST_JAVA_VERSION: "11"

include:
  - template: Jobs/SAST.gitlab-ci.yml
  - template: Jobs/Dependency-Scanning.gitlab-ci.yml

spotless:
  stage: check
  dependencies: []
  needs: []
  script:
    - echo "Spotless check started"
    - "mvn spotless:check"

pmd:
  stage: check
  dependencies: [build-core]
  needs: [build-core]
  script:
    - echo "PMD checks started"
    - "mvn pmd:check"
  artifacts:
    name: pmd
    expire_in: 3 days
    when: always
    paths:
      - core/reports/pmd
      - adapter/spark/reports/pmd

checkstyle:
  stage: check
  dependencies: []
  needs: []
  script:
    - echo "Checkstyle checks started"
    - "mvn checkstyle:check"
  artifacts:
    name: checkstyle
    expire_in: 3 days
    when: always
    paths:
      - core/reports/checkstyle/violations.txt
      - adapter/spark/reports/checkstyle/violations.txt


sast:
  stage: check
  allow_failure: true

semgrep-sast:
  stage: check
  needs: []
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
    - if: $CI_COMMIT_REF_NAME == 'dev'
    - if: $CI_COMMIT_REF_NAME == 'main'


dependency_scanning:
  stage: check
  allow_failure: true

gemnasium-maven-dependency_scanning:
  stage: check
  needs: []
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
    - if: $CI_COMMIT_REF_NAME == 'dev'
    - if: $CI_COMMIT_REF_NAME == 'main'
